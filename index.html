<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quiz</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* Reset b√°sico */
    * {
      box-sizing: border-box;
    }
    body {
      background: #f0f4f8;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 2rem;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      color: #333;
      position: relative;
      padding-bottom: 80px; /* espa√ßo para o bot√£o fixo no rodap√© */
    }
    .question-box {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
      padding: 2rem 2.5rem;
      max-width: 600px;
      width: 100%;
    }
    h1 {
      text-align: center;
      color: #1e2a78;
      margin-bottom: 1.5rem;
      font-weight: 700;
      letter-spacing: 0.05em;
      user-select: none;
    }
    #questionText {
      font-size: 1.3rem;
      font-weight: 600;
      margin-bottom: 1.2rem;
      min-height: 3.2rem;
      user-select: none;
    }
    .options {
      list-style: none;
      padding: 0;
      margin: 0 0 1.5rem 0;
    }
    .options li {
      margin-bottom: 0.75rem;
    }
    .options button {
      width: 100%;
      padding: 0.75rem 1.25rem;
      font-size: 1rem;
      background: #e2e8f0;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.25s ease;
      user-select: none;
      color: #1e2a78;
      font-weight: 600;
      box-shadow: 0 1px 3px rgba(30, 42, 120, 0.2);
    }
    .options button:hover:not(:disabled) {
      background: #cbd5e1;
    }
    .options button:disabled {
      cursor: default;
      opacity: 0.6;
      background: #94a3b8;
      color: #f0f4f8;
      box-shadow: none;
    }
    #nextButton {
      background: #3b82f6;
      color: white;
      font-weight: 700;
      padding: 0.75rem 1.5rem;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      user-select: none;
      box-shadow: 0 4px 8px rgba(59,130,246,0.4);
      transition: background-color 0.3s ease;
      display: block;
      margin: 0 auto 1.5rem auto;
      min-width: 180px;
    }
    #nextButton:disabled {
      background: #93c5fd;
      cursor: default;
      box-shadow: none;
    }
    #nextButton:hover:not(:disabled) {
      background: #2563eb;
      box-shadow: 0 6px 12px rgba(37,99,235,0.5);
    }
    .feedback {
      font-weight: 700;
      font-size: 1.15rem;
      margin-bottom: 1.5rem;
      min-height: 1.5rem;
    }

    /* Bot√£o Limpar Progresso fixo no rodap√© e azul */
    #clearProgress {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #3b82f6;
      color: white;
      font-weight: 700;
      padding: 0.75rem 1.5rem;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      user-select: none;
      box-shadow: 0 4px 8px rgba(59,130,246,0.4);
      transition: background-color 0.3s ease;
      min-width: 180px;
      z-index: 1000;
    }
    #clearProgress:hover {
      background: #2563eb;
      box-shadow: 0 6px 12px rgba(37,99,235,0.5);
    }
  </style>
</head>
<body>
  <h1>Quiz de Perguntas</h1>
  <div class="question-box" id="questionBox">
    <div id="questionText">Carregando...</div>
    <ul class="options" id="optionsList"></ul>
    <div class="feedback" id="feedback"></div>
    <button id="nextButton">Pr√≥xima pergunta</button>
    <div class="score" id="scoreBox"></div>
  </div>

  <button id="clearProgress">üóëÔ∏è Limpar progresso</button>

  <script>
    const STORAGE_KEY = 'answeredQuestions';
    const SCORE_KEY = 'quizScore';
    const WRONG_KEY = 'wrongAnswers';
    const RETRY_KEY = 'retryMode';
    let questions = [];

    async function loadQuestions() {
      const response = await fetch('questions.md');
      const markdown = await response.text();
      const lines = markdown.split('\n');
      const parsed = [];
      let current = null;

      lines.forEach(line => {
        if (line.startsWith('### ')) {
          if (current) parsed.push(current);
          current = {
            id: parsed.length + 1,
            question: line.replace('### ', '').trim(),
            options: [],
            correctIndex: -1
          };
        } else if (line.startsWith('- ')) {
          const isCorrect = line.includes('[x]');
          const text = line.replace(/- \[.\] /, '').trim();
          current.options.push(text);
          if (isCorrect) current.correctIndex = current.options.length - 1;
        }
      });

      if (current) parsed.push(current);
      questions = parsed;
      showRandomQuestion();
      showScore();
    }

    function getAnsweredIds() {
      const data = localStorage.getItem(STORAGE_KEY);
      return data ? JSON.parse(data) : [];
    }

    function getWrongAnswers() {
      const data = localStorage.getItem(WRONG_KEY);
      return data ? JSON.parse(data) : [];
    }

    function saveAnsweredId(id, correct) {
      const answered = getAnsweredIds();
      if (!answered.includes(id)) answered.push(id);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(answered));

      const wrong = getWrongAnswers();
      if (!correct && !wrong.includes(id)) {
        wrong.push(id);
        localStorage.setItem(WRONG_KEY, JSON.stringify(wrong));
      }
    }

    function getScore() {
      return parseInt(localStorage.getItem(SCORE_KEY)) || 0;
    }

    function updateScore(increment = 1) {
      const currentScore = getScore();
      const newScore = currentScore + increment;
      localStorage.setItem(SCORE_KEY, newScore);
    }

    function showScore() {
      const scoreBox = document.getElementById('scoreBox');
      const total = getAnsweredIds().length;
      const score = getScore();
      scoreBox.innerText = `Pontua√ß√£o: ${score} / ${total}`;
    }

    function getUnansweredQuestions() {
      const retry = JSON.parse(localStorage.getItem(RETRY_KEY) || 'null');
      const answered = getAnsweredIds();
      if (retry && Array.isArray(retry)) {
        return questions.filter(q => retry.includes(q.id) && !answered.includes(q.id));
      }
      return questions.filter(q => !answered.includes(q.id));
    }

    function showRandomQuestion() {
      const remaining = getUnansweredQuestions();
      const box = document.getElementById('questionBox');
      const feedback = document.getElementById('feedback');
      feedback.innerText = '';

      if (remaining.length === 0) {
        document.getElementById('questionText').innerText = 'Voc√™ respondeu todas as perguntas!';
        document.getElementById('optionsList').innerHTML = '';
        document.getElementById('nextButton').disabled = true;
        showScore();
        showRestartOptions();
        return;
      }

      const random = remaining[Math.floor(Math.random() * remaining.length)];
      document.getElementById('questionText').innerText = random.question;
      document.getElementById('optionsList').innerHTML = '';

      random.options.forEach((option, index) => {
        const li = document.createElement('li');
        const btn = document.createElement('button');
        btn.innerText = option;
        btn.onclick = () => {
          const isCorrect = index === random.correctIndex;
          feedback.innerText = isCorrect 
            ? '‚úÖ Correto!' 
            : `‚ùå Errado. A resposta correta era: ${random.options[random.correctIndex]}`;

          saveAnsweredId(random.id, isCorrect);
          showScore();

          // Desabilita todos os bot√µes e remove sele√ß√µes anteriores
          const allButtons = document.querySelectorAll('#optionsList button');
          allButtons.forEach(b => {
            b.disabled = true;
            b.classList.remove('selected');
          });

          btn.classList.add('selected');
          document.getElementById('nextButton').disabled = false;
        };
        li.appendChild(btn);
        document.getElementById('optionsList').appendChild(li);
      });

      document.getElementById('nextButton').disabled = true;
    }

    function showRestartOptions() {
      // Aqui pode colocar op√ß√µes para resetar, ou s√≥ deixar o bot√£o limpar
    }

    document.getElementById('nextButton').onclick = () => {
      showRandomQuestion();
    };

    document.getElementById('clearProgress').onclick = () => {
      if (confirm('Tem certeza de que deseja apagar todo o progresso?')) {
        localStorage.removeItem(STORAGE_KEY);
        localStorage.removeItem(SCORE_KEY);
        localStorage.removeItem(WRONG_KEY);
        localStorage.removeItem(RETRY_KEY);
        document.getElementById('nextButton').disabled = false;
        showScore();
        showRandomQuestion();
      }
    };

    window.onload = loadQuestions;
  </script>
</body>
</html>
